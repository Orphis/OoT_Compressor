#include "rom.h"

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>
#include <vector>

#include "util.h"

#define UINTSIZE 0x01000000
#define COMPSIZE 0x02000000
#define DCMPSIZE 0x04000000

N64ROM::N64ROM(std::string file_name) : name(file_name) {
  load();
}

void N64ROM::load() {
  data = loadROM(name.c_str());
}

std::vector<uint8_t> loadROM(const char* name)
{
	uint32_t size, i;
	uint16_t* tempROM;
	FILE* romFile;
	std::vector<uint8_t> inROM;
	
	/* Open file, make sure it exists */
	romFile = fopen(name, "rb");
	if(romFile == NULL)
	{
		perror(name);
		exit(1);
	}
	/* Find size of file */
	fseek(romFile, 0, SEEK_END);
	size = ftell(romFile);
	fseek(romFile, 0, SEEK_SET);

	/* If it's not the right size, exit */
	if(size != COMPSIZE)
	{
		fprintf(stderr, "Error, %s is not the correct size", name);
		exit(1);
	}

	inROM.resize(size);
	/* Read to inROM, close romFile, and copy to outROM */
	fread(inROM.data(), sizeof(char), size, romFile);
	tempROM = (uint16_t*)inROM.data();
	fclose(romFile);

	/* bSwap_32 if needed */
	if (inROM[0] == 0x37)
		for (i = 0; i < UINTSIZE; i++)
			tempROM[i] = byteSwap(tempROM[i]);

	return inROM;
}

const char* N64ROM::oot_us_v1_0_index =
"0000000000111110000000000001111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111110101010101010101010101010101010101010101010101010101010101"
"0101011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
"11111111110000000000000000";
